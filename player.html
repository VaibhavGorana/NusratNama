<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NusratNama | Player</title>
  <style>
    /* ================= RESET & THEME ================= */
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body { height:100%; }
    body {
      font-family: Georgia, "Times New Roman", serif;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(212,175,55,0.08), transparent 45%) no-repeat,
                  linear-gradient(180deg, #0d0c0c, #151515);
      color:#efeae1;
      line-height:1.55;
    }
    a { color: inherit; text-decoration: none; }
    :root{
      --gold:#d4af37; --gold-2:#b9982c; --ink:#080706; --muted:#bfb7ac; --card:#121212; --card-2:#1a1a1a;
      --chip-love:#ff6b9a; --chip-love-bg:#d6336c33;
      --chip-spiritual:#63e6be; --chip-spiritual-bg:#0ca67833;
      --chip-live:#ff8787; --chip-live-bg:#e0313133;
      --chip-legend:#ffd43b; --chip-legend-bg:#f59f0033;
    }

    /* ================= HEADER ================= */
    header { position:sticky; top:0; z-index:1000; backdrop-filter: blur(6px);
      background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.45)); border-bottom:1px solid rgba(212,175,55,0.08);
      display:flex; align-items:center; justify-content:space-between; padding:14px 28px; }
    .logo { font-weight:700; color:var(--gold); font-size:1.45rem; letter-spacing:.3px; }
    nav { display:flex; gap:18px; }
    nav a { padding:6px 8px; border-radius:8px; font-weight:600; opacity:.9; }
    nav a[aria-current="page"], nav a:hover { color:var(--gold); opacity:1; }

    /* ================= LAYOUT ================= */
    main { max-width:1200px; margin:0 auto; padding:24px 16px 120px; }
    .grid { display:grid; grid-template-columns: 2fr 1fr; gap:22px; align-items:start; }
    @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } }

    /* ================= PLAYER WRAPPER ================= */
    .player-wrap { background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.15)); border:1px solid rgba(212,175,55,.08); border-radius:16px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,.35); animation:fadeIn .5s ease; }
    .player-top { position:relative; background:#000; }
    .player-aspect { aspect-ratio:16/9; width:100%; background:#000; position:relative; }
    video { width:100%; height:100%; display:block; background:#000; }

    .buffer-wrap { position:absolute; left:16px; right:16px; bottom:10px; height:6px; border-radius:6px; background:#2a2a2a; overflow:hidden; opacity:.9; }
    .buffered { position:absolute; height:100%; left:0; width:0%; background:#777; opacity:.6; transition: width .15s linear; }
    .played { position:absolute; height:100%; left:0; width:0%; background:var(--gold); transition: width .1s linear; }

    .controls { display:flex; gap:10px; align-items:center; padding:12px 14px; background:#111; border-top:1px solid rgba(212,175,55,.08); }
    .controls .left, .controls .right { display:flex; gap:8px; align-items:center; }
    .btn { border:none; background:var(--gold); color:var(--ink); font-weight:700; border-radius:10px; padding:8px 12px; cursor:pointer; transition: transform .12s ease, background .2s ease; }
    .btn:hover { background:var(--gold-2); transform: translateY(-1px); }
    .btn.ghost { background:transparent; border:1px solid rgba(212,175,55,.25); color:#efeae1; }
    .btn.ghost:hover { background:rgba(212,175,55,.12); }
    .time { font-variant-numeric: tabular-nums; color:var(--muted); font-weight:700; min-width:102px; text-align:center; }
    .seek { flex:1; height:8px; background:#2a2a2a; border-radius:6px; position:relative; cursor:pointer; }
    .seek .bar { position:absolute; inset:0; }

    .range { appearance:none; width:110px; height:6px; background:#333; border-radius:999px; outline:none; }
    .range::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:14px; height:14px; border-radius:50%; background:var(--gold); border:none; cursor:pointer; }

    /* ================= META & LYRICS ================= */
    .meta { padding:16px 16px 18px; display:flex; flex-direction:column; gap:10px; }
    .title { font-size:1.45rem; font-weight:800; color:var(--gold); }
    .artist { color:var(--muted); }
    .chips { display:flex; flex-wrap:wrap; gap:8px; }
    .chip { font-size:.85rem; font-weight:700; padding:4px 8px; border-radius:999px; }
    .chip.love { background:var(--chip-love-bg); color:var(--chip-love); }
    .chip.spiritual { background:var(--chip-spiritual-bg); color:var(--chip-spiritual); }
    .chip.live { background:var(--chip-live-bg); color:var(--chip-live); }
    .chip.legendary { background:var(--chip-legend-bg); color:var(--chip-legend); }

    .actions { display:flex; gap:10px; margin-top:6px; }

    .accordion { margin-top:10px; border-top:1px solid rgba(212,175,55,.08); }
    .acc-head { display:flex; align-items:center; justify-content:space-between; cursor:pointer; padding:12px 8px; user-select:none; }
    .acc-head h3 { font-size:1rem; font-weight:800; }
    .acc-body { max-height:0; overflow:hidden; transition:max-height .35s ease; }
    .lyrics { white-space:pre-wrap; padding:8px; color:#efeae1; line-height:1.7; }

    /* ================= SIDEBAR ================= */
    .side { position:sticky; top:76px; display:flex; flex-direction:column; gap:14px; }
    .side h3 { color:var(--gold); font-size:1.05rem; }
    .list { display:flex; flex-direction:column; gap:10px; }
    .tile { display:grid; grid-template-columns: 120px 1fr; gap:10px; padding:10px; align-items:center; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12)); border:1px solid rgba(212,175,55,.06); cursor:pointer; transition: transform .12s ease, box-shadow .12s ease; }
    .tile:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(212,175,55,.1); }
    .tile.active { outline:2px solid rgba(212,175,55,.35); }
    .tile img { width:100%; height:68px; object-fit:cover; border-radius:8px; }
    .tile .name { font-weight:800; color:#efeae1; }
    .tile .sub { font-size:.9rem; color:var(--muted); }

    /* ================= MINI PLAYER ================= */
    .mini { position:fixed; right:18px; bottom:18px; width:340px; background:#111; border:1px solid rgba(212,175,55,.12); border-radius:16px; box-shadow:0 18px 60px rgba(0,0,0,.45); z-index:1500; overflow:hidden; display:none; }
    .mini.active { display:block; animation:slideUp .28s ease; }
    .mini video { width:100%; height:auto; display:block; background:#000; }
    .mini .mini-bar { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; gap:8px; }
    .mini .mini-title { font-weight:800; color:var(--gold); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .mini .mini-controls { display:flex; gap:6px; }

    /* ================= HELPERS ================= */
    .sr { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    .muted { color:var(--muted); }
    .divider { height:1px; background:rgba(212,175,55,.08); margin:6px 0; }
aside.side {
  max-height: 500px;   /* fixed panel size */
  overflow-y: auto;    /* scrollable */
}

#recoList .tile {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  padding: 6px;
  cursor: pointer;
  border-radius: 6px;
  transition: background 0.2s;
}
#recoList .tile:hover { background: rgba(255,255,255,0.05); }
#recoList .tile.active { background: rgba(255,255,255,0.15); }

#recoList .thumb {
  width: 60px;
  height: 60px;
  background-size: cover;
  background-position: center;
  border-radius: 4px;
}
#recoList .info {
  flex: 1;
  color: #ddd;
}
#recoList .info .name { font-weight: 600; color: #fff; }
#recoList .info .sub { font-size: 0.8em; color: #aaa; margin-top: 2px; }


    @keyframes fadeIn { from{opacity:0; transform:translateY(6px);} to{opacity:1; transform:translateY(0);} }
    @keyframes slideUp { from{ transform: translateY(16px); opacity:0;} to{ transform: translateY(0); opacity:1;} }
    
  </style><link rel="icon" type="image/png" href="1000045731.png">
</head>
<body>
  <header>
    <div class="logo">NusratNama</div>
    <nav>
      <a href="index.html">Home</a>
       <a href="allsong.html">All Songs</a>
      <a href="legacy.html">Legacy</a>
      <a href="discover.html">Discover</a>     
      <a href="join.html">Join</a>
      <a aria-current="page" href="player.html">Player</a>
    </nav>
  </header>

  <main>
    <div class="grid">
      <!-- ================= LEFT: PLAYER + META ================= -->
      <section class="player-wrap" id="playerWrap">
        <div class="player-top">
          <div class="player-aspect" id="playerBox">
            <video id="video" preload="metadata" playsinline></video>
            <div class="buffer-wrap" aria-hidden="true">
              <div class="buffered" id="buffered"></div>
              <div class="played" id="played"></div>
            </div>
          </div>
          <div class="controls" aria-label="Player Controls">
            <div class="left">
              <button class="btn" id="btnPlay" title="Play/Pause">‚ñ∂Ô∏è / ‚è∏</button>
              <button class="btn ghost" id="btnPrev" title="Previous">‚èÆ</button>
              <button class="btn ghost" id="btnNext" title="Next">‚è≠</button>
              <span class="time" id="time">00:00 / 00:00</span>
            </div>
            <div class="seek" id="seek">
              <div class="bar" id="seekBar"></div>
            </div>
            <div class="right">
              <input type="range" class="range" id="vol" min="0" max="1" step="0.01" value="0.85" aria-label="Volume" />
              <button class="btn ghost" id="btnMute" title="Mute">üîá</button>
              <button class="btn ghost" id="btnFs" title="Fullscreen">‚õ∂</button>
              <button class="btn" id="btnMini" title="Minimize">‚ñ¢</button>
            </div>
          </div>
        </div>

        <div class="meta">
          <div class="title" id="songTitle">‚Äî</div>
          <div class="artist" id="songArtist">Nusrat Fateh Ali Khan</div>
          <div class="chips" id="songTags"></div>
          <div class="actions">
            <button class="btn ghost" id="btnLike">üëç Like</button>
            <button class="btn ghost" id="btnFav">üîñ Save</button>
            <button class="btn ghost" id="btnAddPl">‚ûï Add to Playlist</button>
          </div>

          <div class="accordion" id="accLyrics">
            <div class="acc-head" id="toggleLyrics">
              <h3>Lyrics</h3>
              <span id="lyrChevron">‚ñæ</span>
            </div>
            <div class="acc-body" id="lyricsBody">
              <div class="lyrics" id="lyricsText">Lyrics not available for this track.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= RIGHT: RECOMMENDATIONS / PLAYLIST ================= -->
      <aside class="side">
        <h3 id="sideTitle">Up Next</h3>
        <div class="list" id="recoList"></div>
      </aside>
    </div>
  </main>

  <!-- ================= MINI PLAYER (GLOBAL) ================= -->
  <div class="mini" id="mini">
    <video id="miniVideo" playsinline></video>
    <div class="mini-bar">
      <div class="mini-title" id="miniTitle">‚Äî</div>
      <div class="mini-controls">
        <button class="btn ghost" id="miniPrev" title="Previous">‚èÆ</button>
        <button class="btn" id="miniPlay" title="Play/Pause">‚ñ∂Ô∏è / ‚è∏</button>
        <button class="btn ghost" id="miniNext" title="Next">‚è≠</button>
        <button class="btn ghost" id="miniClose" title="Close">‚úñ</button>
      </div>
    </div>
  </div>
<script src="allsong.js"> </script>
<script src="playlist.js"> </script>
  <script>
    // ===================== DATA (NOW DYNAMIC) =====================
    // Reads songs from localStorage key "nn_songs" and normalizes fields.
    // If nothing valid is found, falls back to DEFAULT_SONGS (your original list).
    function loadSongsFromLocalStorage(){
      try{
        const raw = localStorage.getItem('nn_songs');
        if(!raw) return null;
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr) || !arr.length) return null;
        const norm = arr.map((item, i) => {
          const id = Number(item.id ?? (i+1));
          const title = String(item.title ?? `Track ${id}`);
          const file = String(item.file ?? item.url ?? '');
          const cover = String(item.cover ?? item.thumbnail ?? item.image ?? `https://placehold.co/640x360?text=${encodeURIComponent(title)}`);
          const tags = Array.isArray(item.tags) ? item.tags : [];
          const lyrics = typeof item.lyrics === 'string' ? item.lyrics : '';
          return file ? { id, title, file, cover, tags, lyrics } : null;
        }).filter(Boolean);

        // Ensure unique + valid IDs
        const seen = new Set();
        norm.forEach((s, idx) => {
          if (!Number.isFinite(s.id) || seen.has(s.id)) s.id = idx + 1;
          seen.add(s.id);
        });

        return norm.length ? norm : null;
      }catch(e){
        return null;
      }
    }


    //const SONGS = loadSongsFromLocalStorage() ?? AllSONGS;

    // Map for colored chips
    const TAG_CLASS = {
      love: 'love', spiritual: 'spiritual', devotional:'spiritual', live:'live', sufi:'spiritual', legendary:'legendary'
    };

    // ===================== HELPERS =====================
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmt = s => isNaN(s) ? '00:00' :
      `${Math.floor(s/60).toString().padStart(2,'0')}:${Math.floor(s%60).toString().padStart(2,'0')}`;

    function getQuery(){
      const p = new URLSearchParams(location.search);
      const id = Number(p.get('id')) || AllSONGS[0].id;
      const listRaw = p.get('list');
      const list = listRaw ? listRaw.split(',').map(n=>Number(n)).filter(Boolean) : null;
      return { id, list };
    }

    // ===================== STATE =====================
    let state = {
      queue: [],         // array of song ids (context: playlist or recommendations)
      currentId: null,   // active song id
      minimized: false,
      liked: new Set(JSON.parse(localStorage.getItem('nn_likes')||'[]')),
      favs: new Set(JSON.parse(localStorage.getItem('nn_favs')||'[]'))
    };

    // DOM refs
    const video = $('#video');
    const playerWrap = $('#playerWrap');
    const songTitle = $('#songTitle');
    const songArtist = $('#songArtist');
    const songTags = $('#songTags');
    const btnPlay = $('#btnPlay');
    const btnPrev = $('#btnPrev');
    const btnNext = $('#btnNext');
    const btnMini = $('#btnMini');
    const btnFs = $('#btnFs');
    const btnMute = $('#btnMute');
    const vol = $('#vol');
    const timeEl = $('#time');
    const seek = $('#seek');
    const seekBar = $('#seekBar');
    const playedBar = $('#played');
    const bufferedBar = $('#buffered');

    const lyrAcc = $('#accLyrics');
    const lyrToggle = $('#toggleLyrics');
    const lyrBody = $('#lyricsBody');
    const lyrChevron = $('#lyrChevron');
    const lyrText = $('#lyricsText');

    const sideTitle = $('#sideTitle');
    const recoList = $('#recoList');

    // mini
    const mini = $('#mini');
    const miniVideo = $('#miniVideo');
    const miniTitle = $('#miniTitle');
    const miniPlay = $('#miniPlay');
    const miniPrev = $('#miniPrev');
    const miniNext = $('#miniNext');
    const miniClose = $('#miniClose');

    // ===================== INIT =====================
    const q = getQuery();
   function getSongById(id){ 
  return (SONGS.find(s => s.id === id) || AllSONGS.find(s => s.id === id)); 
}


   let SONGS = [];
function buildQueue(baseId, externalList){
  if (externalList && externalList.length){
    SONGS = AllSONGS.filter(s => externalList.includes(s.id));
    state.queue = externalList;
    sideTitle.textContent = 'Playlist';
  } else {
    const base = AllSONGS.find(s=>s.id===baseId);
    const tags = new Set(base?.tags||[]);
    let rec = AllSONGS.filter(s=> s.id!==baseId && s.tags?.some(t=>tags.has(t)));

    if (!rec.length) rec = AllSONGS.filter(s=>s.id!==baseId);

    SONGS = [base, ...rec];   // for sidebar rendering
    state.queue = [baseId, ...rec.map(s=>s.id)];
    sideTitle.textContent = 'Recommended';
  }
}

    // Render sidebar tiles
function renderQueue(activeId){
  const ids = state.queue.length ? state.queue : SONGS.map(s=>s.id);
  recoList.innerHTML = '';
  ids.forEach(id=>{
    const s = getSongById(id);
    if(!s) return;

    const el = document.createElement('div');
    el.className = 'tile' + (id===activeId ? ' active' : '');
    el.innerHTML = `
      <div class="thumb" style="background-image:url('${s.cover}')"></div>
      <div class="info">
        <div class="name">${s.title}</div>
        <div class="sub">${(s.tags||[]).slice(0,3).join(' ‚Ä¢ ')}</div>
      </div>
    `;
    el.addEventListener('click', ()=> loadSong(id, true));
    recoList.appendChild(el);
  });
}

    /// Load song into player
function loadSong(id, pushState = true) {
  const s = getSongById(id) || SONGS[0];
  state.currentId = s.id;

  // Update URL (so sharing/back/forward works)
  if (pushState) {
    const url = new URL(location.href);
    url.searchParams.set('id', s.id);
    history.pushState({}, '', url);
  }

  // Bind meta
  songTitle.textContent = s.title;
  songArtist.textContent = 'Nusrat Fateh Ali Khan';
  songTags.innerHTML = (s.tags || [])
    .map(t => `<span class="chip ${TAG_CLASS[t] || ''}">${t}</span>`)
    .join('');

  // Lyrics
  lyrText.textContent = s.lyrics || 'Lyrics not available for this track.';

  // Video (always autoplay new song)
  video.src = s.file;
  video.load();
  video.play().catch(() => {}); // <-- force autoplay

  // Media Session
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: s.title,
      artist: 'Nusrat Fateh Ali Khan',
      album: 'NusratNama',
      artwork: [{ src: s.cover, sizes: '640x360', type: 'image/jpeg' }]
    });
  }

  // Update sidebar highlights
  renderQueue(s.id);
}


      // Sidebar
      buildQueue(q.id, q.list);
renderQueue(q.id);
// loadSong(q.id, true);

    

    // Controls: time + progress
    function updateTime(){
      const d = video.duration || 0, c = video.currentTime || 0;
      timeEl.textContent = `${fmt(c)} / ${fmt(d)}`;
      const playedPct = d ? (c/d)*100 : 0;
      playedBar.style.width = playedPct + '%';

      // buffered
      if (video.buffered && video.buffered.length){
        const end = video.buffered.end(video.buffered.length-1);
        const bufPct = d ? (end/d)*100 : 0;
        bufferedBar.style.width = bufPct + '%';
      }
      requestAnimationFrame(updateTime);
    }

    // Seek handling
    function seekAt(clientX){
      const rect = seek.getBoundingClientRect();
      const ratio = Math.min(1, Math.max(0, (clientX - rect.left) / rect.width));
      video.currentTime = ratio * (video.duration || 0);
    }

    // Next / Prev logic within queue
    function nextId(){
      const idx = state.queue.indexOf(state.currentId);
      return state.queue[(idx+1) % state.queue.length];
    }
    function prevId(){
      const idx = state.queue.indexOf(state.currentId);
      return state.queue[(idx-1+state.queue.length) % state.queue.length];
    }

    // ===================== MINI PLAYER =====================
    function minimize(){
      if (state.minimized) return; // already minimized
      state.minimized = true;
      // Move the playing <video> element into mini player to keep continuity
      miniVideo.replaceWith(video);
      mini.insertBefore(video, mini.firstChild);
      mini.classList.add('active');
      playerWrap.style.display = 'none';
      miniTitle.textContent = songTitle.textContent;
      localStorage.setItem('nn_mini', JSON.stringify({ id: state.currentId, t: video.currentTime }));
    }
    function restore(){
      if (!state.minimized) return;
      state.minimized = false;
      // Move <video> back to main player box
      const box = document.getElementById('playerBox');
      box.insertBefore(video, box.firstChild);
      mini.classList.remove('active');
      playerWrap.style.display = '';
      localStorage.removeItem('nn_mini');
    }
    function closeMini(){
      video.pause();
      restore();
    }

    // ===================== EVENTS =====================
    // Player buttons
    btnPlay.addEventListener('click', ()=> video.paused ? video.play() : video.pause());
    btnPrev.addEventListener('click', ()=> loadSong(prevId()));
    btnNext.addEventListener('click', ()=> loadSong(nextId()));
    btnMini.addEventListener('click', minimize);

    btnFs.addEventListener('click', ()=>{
      const el = document.getElementById('playerWrap');
      if (!document.fullscreenElement) el.requestFullscreen?.();
      else document.exitFullscreen?.();
    });

    vol.addEventListener('input', ()=> { video.volume = +vol.value; video.muted = (video.volume===0); });
    btnMute.addEventListener('click', ()=> { video.muted = !video.muted; });

    // Seek mouse & touch
    seek.addEventListener('click', e=> seekAt(e.clientX));
    seek.addEventListener('mousemove', e=> { if (e.buttons===1) seekAt(e.clientX); });
    seek.addEventListener('touchstart', e=> { if (e.touches[0]) seekAt(e.touches[0].clientX); }, {passive:true});
    seek.addEventListener('touchmove', e=> { if (e.touches[0]) seekAt(e.touches[0].clientX); }, {passive:true});

    // Update loops
    video.addEventListener('play', ()=> btnPlay.textContent = '‚è∏ Pause');
    video.addEventListener('pause', ()=> btnPlay.textContent = '‚ñ∂Ô∏è Play');
    video.addEventListener('ended', ()=> loadSong(nextId()));

    // Acc: Lyrics
    let lyrOpen = false;
    lyrToggle.addEventListener('click', ()=>{
      lyrOpen = !lyrOpen;
      lyrBody.style.maxHeight = lyrOpen ? (lyrText.scrollHeight + 24) + 'px' : '0px';
      lyrChevron.textContent = lyrOpen ? '‚ñ¥' : '‚ñæ';
    });

    // Sidebar mini controls mirror
    miniPlay.addEventListener('click', ()=> video.paused ? video.play() : video.pause());
    miniPrev.addEventListener('click', ()=> loadSong(prevId()));
    miniNext.addEventListener('click', ()=> loadSong(nextId()));
    miniClose.addEventListener('click', closeMini);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
      if (e.code==='Space'){ e.preventDefault(); video.paused ? video.play() : video.pause(); }
      if (e.key==='ArrowRight') video.currentTime = Math.min((video.currentTime||0)+5, video.duration||0);
      if (e.key==='ArrowLeft') video.currentTime = Math.max((video.currentTime||0)-5, 0);
      if (e.key==='f' || e.key==='F') btnFs.click();
      if (e.key==='m' || e.key==='M') btnMute.click();
      if (e.key==='l' || e.key==='L') lyrToggle.click();
    });

    // History popstate (back/forward)
    window.addEventListener('popstate', ()=>{
      const { id, list } = getQuery();
      buildQueue(id, list);
      loadSong(id, false);
    });

    // Media Session actions
    if ('mediaSession' in navigator){
      navigator.mediaSession.setActionHandler('play', ()=> video.play());
      navigator.mediaSession.setActionHandler('pause', ()=> video.pause());
      navigator.mediaSession.setActionHandler('previoustrack', ()=> loadSong(prevId()));
      navigator.mediaSession.setActionHandler('nexttrack', ()=> loadSong(nextId()));
      navigator.mediaSession.setActionHandler('seekbackward', ()=> video.currentTime = Math.max(0,(video.currentTime||0)-10));
      navigator.mediaSession.setActionHandler('seekforward', ()=> video.currentTime = Math.min((video.currentTime||0)+10, video.duration||0));
    }

    // Boot
    (function init(){
      const { id, list } = getQuery();
      buildQueue(id, list);
      renderQueue(id);
      loadSong(id, false);
      const volEl = document.getElementById('vol');
      const videoEl = document.getElementById('video');
      videoEl.volume = +volEl.value;
      requestAnimationFrame(updateTime);

      // Restore mini if needed (same-page only)
      const saved = localStorage.getItem('nn_mini');
      if (saved){ try{ const data = JSON.parse(saved); if (data?.id){ loadSong(data.id, false); video.currentTime = data.t||0; minimize(); } } catch(_){} }
    })();
  </script>
</body>
</html>
